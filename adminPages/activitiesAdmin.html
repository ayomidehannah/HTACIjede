<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>
      Holy Trinity Anglican Church, Ijede Website - Admin Activities
    </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container py-5">
      <div class="text-center mb-5">
        <h1 class="fw-bold text-primary">Edit or Add Weekly Activities</h1>
      </div>

      <form id="activitiesForm" class="row g-4 justify-content-center">
        <!-- Activity cards will render here -->
      </form>

      <div class="d-flex justify-content-center mt-4 gap-3">
        <button type="button" id="addActivityBtn" class="btn btn-success">
          <i class="fa fa-plus me-2"></i>Add Activity
        </button>
        <button type="button" id="saveActivitiesBtn" class="btn btn-primary">
          <i class="fa fa-save me-2"></i>Save Changes
        </button>
      </div>
    </div>

    <script>
      const availableIcons = [
        { name: "Bible", class: "fa-bible" },
        { name: "Praying Hands", class: "fa-praying-hands" },
        { name: "Pray", class: "fa-pray" },
        { name: "Wine Glass", class: "fa-wine-glass" },
        { name: "Book Open", class: "fa-book-open" },
        { name: "People Carry", class: "fa-people-carry" },
      ];

      let activities = [
        {
          day: "Mondays & Saturdays",
          title: "Morning Prayer",
          subtitle: "(Adura Owuro)",
          time: ["5:30am"],
          color: "primary",
          iconClass: "fa-praying-hands",
        },
        {
          day: "1st Day of the Month",
          title: "Adura Ajigbare",
          subtitle: "(Begin With Jesus)",
          time: ["6:00am", "5:00pm – 6:00pm"],
          color: "success",
          iconClass: "fa-bible",
        },
        {
          day: "Tuesdays",
          title: "Women's Prayer",
          subtitle: "(Eto Obinrin)",
          time: ["5:00pm", "Bible Study: 6:00pm"],
          color: "warning",
          iconClass: "fa-book-open",
        },
        {
          day: "Wednesdays",
          title: "Mid-week Holy Communion Service",
          subtitle: "",
          time: ["5:30pm"],
          color: "info",
          iconClass: "fa-wine-glass",
        },
        {
          day: "Thursdays",
          title: "Hour Of Mercy",
          subtitle: "(Wakati Aanu)",
          time: ["7:30am – 9:30am", "Lay Readers / Teachers Class: 5:00pm"],
          color: "danger",
          iconClass: "fa-pray",
        },
        {
          day: "Saturdays",
          title: "Choir / Youth / Brigade Activities",
          subtitle: "",
          time: ["5:00pm"],
          color: "secondary",
          iconClass: "fa-people-carry",
        },
      ];

      const form = document.getElementById("activitiesForm");

      function idFor(idx, field) {
        return `${field}${idx}`;
      }

      function renderActivities() {
        form.innerHTML = "";

        activities.forEach((act, idx) => {
          const timesString = act.time.join(", ");

          const card = document.createElement("div");
          card.className = "col-md-6 col-lg-4";

          card.innerHTML = `
        <div class="card shadow-sm border-0 h-100">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title text-${act.color} fw-bold mb-0">Activity ${
            idx + 1
          }</h5>
              <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteActivity(${idx})" title="Delete Activity">
                <i class="fa fa-trash"></i>
              </button>
            </div>

            <!-- Icon Dropdown -->
            <div class="mb-3 text-center">
              <label class="form-label fw-semibold d-block">Activity Icon</label>
              <div class="mb-2">
                <span class="bg-${
                  act.color
                } rounded-circle d-inline-flex align-items-center justify-content-center" style="width:70px; height:70px;">
                  <i class="fa ${
                    act.iconClass
                  } fa-2x text-white" id="iconPreview${idx}"></i>
                </span>
              </div>

              <select class="form-select" id="${idFor(
                idx,
                "icon"
              )}" onchange="updateIcon(${idx})">
                ${availableIcons
                  .map(
                    (icon) => `
                  <option value="${icon.class}" ${
                      act.iconClass === icon.class ? "selected" : ""
                    }>${icon.name}</option>
                `
                  )
                  .join("")}
              </select>
            </div>

            <div class="mb-3">
              <label for="${idFor(
                idx,
                "day"
              )}" class="form-label fw-semibold">Day</label>
              <input type="text" class="form-control" id="${idFor(
                idx,
                "day"
              )}" value="${act.day}" />
            </div>

            <div class="mb-3">
              <label for="${idFor(
                idx,
                "title"
              )}" class="form-label fw-semibold">Title</label>
              <input type="text" class="form-control" id="${idFor(
                idx,
                "title"
              )}" value="${act.title}" />
            </div>

            <div class="mb-3">
              <label for="${idFor(
                idx,
                "subtitle"
              )}" class="form-label fw-semibold">Subtitle</label>
              <input type="text" class="form-control" id="${idFor(
                idx,
                "subtitle"
              )}" value="${act.subtitle}" />
            </div>

            <div class="mb-3">
              <label for="${idFor(
                idx,
                "time"
              )}" class="form-label fw-semibold">Times (comma separated)</label>
              <input type="text" class="form-control" id="${idFor(
                idx,
                "time"
              )}" value="${timesString}" />
            </div>

            <div class="mb-3">
              <label for="${idFor(
                idx,
                "color"
              )}" class="form-label fw-semibold">Selected Color</label>
              <select class="form-select" id="${idFor(idx, "color")}">
                <option value="primary" ${
                  act.color === "primary" ? "selected" : ""
                }>Blue</option>
                <option value="secondary" ${
                  act.color === "secondary" ? "selected" : ""
                }>Gray</option>
                <option value="success" ${
                  act.color === "success" ? "selected" : ""
                }>Green</option>
                <option value="danger" ${
                  act.color === "danger" ? "selected" : ""
                }>Red</option>
                <option value="warning" ${
                  act.color === "warning" ? "selected" : ""
                }>Yellow</option>
                <option value="info" ${
                  act.color === "info" ? "selected" : ""
                }>Cyan</option>
                <option value="light" ${
                  act.color === "light" ? "selected" : ""
                }>White</option>
                <option value="dark" ${
                  act.color === "dark" ? "selected" : ""
                }>Black</option>
              </select>
            </div>
          </div>
        </div>
      `;

          form.appendChild(card);
        });
      }

      function updateIcon(idx) {
        const iconClass = document.getElementById(idFor(idx, "icon")).value;
        activities[idx].iconClass = iconClass;
        renderActivities();
      }

      function deleteActivity(index) {
        if (confirm("Are you sure you want to delete this activity?")) {
          activities.splice(index, 1);
          renderActivities();
        }
      }

      function addActivity() {
        activities.push({
          day: "",
          title: "",
          subtitle: "",
          time: [],
          color: "primary",
          iconClass: "fa-bible",
        });
        renderActivities();
      }

      function updateActivitiesFromForm() {
        activities.forEach((act, idx) => {
          act.day = document.getElementById(idFor(idx, "day")).value.trim();
          act.title = document.getElementById(idFor(idx, "title")).value.trim();
          act.subtitle = document
            .getElementById(idFor(idx, "subtitle"))
            .value.trim();
          act.time = document
            .getElementById(idFor(idx, "time"))
            .value.split(",")
            .map((t) => t.trim())
            .filter((t) => t.length > 0);
          act.color = document.getElementById(idFor(idx, "color")).value;
          act.iconClass = document.getElementById(idFor(idx, "icon")).value;
        });
      }

      async function saveActivities() {
        updateActivitiesFromForm();
        console.log("Activities to save:", activities);
        alert("Save function triggered! Connect your API to persist changes.");
      }

      document
        .getElementById("addActivityBtn")
        .addEventListener("click", addActivity);
      document
        .getElementById("saveActivitiesBtn")
        .addEventListener("click", saveActivities);

      renderActivities();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
