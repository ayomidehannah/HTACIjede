<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>
      Holy Trinity Anglican Church, Ijede Website - Admin Activities
    </title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container py-5">
      <div class="text-center mb-5">
        <h1 class="fw-bold text-primary">Edit or Add Weekly Activities</h1>
      </div>

      <form id="activitiesForm" class="row g-4 justify-content-center">
        <!-- Activity tabs will be inserted here -->
      </form>

      <div class="d-flex justify-content-center mt-4 gap-3">
        <button type="button" id="addActivityBtn" class="btn btn-success">
          <i class="fa fa-plus me-2"></i>Add Activity
        </button>
        <button type="button" id="saveActivitiesBtn" class="btn btn-primary">
          <i class="fa fa-save me-2"></i>Save Changes
        </button>
      </div>
    </div>

    <script>
      // Initial activities data
      let activities = [
        {
          day: "Mondays & Saturdays",
          title: "Morning Prayer",
          subtitle: "(Adura Owuro)",
          time: ["5:30am"],
          color: "primary",
          iconUrl: "", // new property for uploaded icon image URL or base64
        },
        {
          day: "1st Day of the Month",
          title: "Adura Ajigbare",
          subtitle: "(Begin With Jesus)",
          time: ["6:00am", "5:00pm – 6:00pm"],
          color: "success",
          iconUrl: "",
        },
        {
          day: "Tuesdays",
          title: "Women's Prayer",
          subtitle: "(Eto Obinrin)",
          time: ["5:00pm", "Bible Study: 6:00pm"],
          color: "warning",
          iconUrl: "",
        },
        {
          day: "Wednesdays",
          title: "Mid-week Holy Communion Service",
          subtitle: "",
          time: ["5:30pm"],
          color: "info",
          iconUrl: "",
        },
        {
          day: "Thursdays",
          title: "Hour Of Mercy",
          subtitle: "(Wakati Aanu)",
          time: ["7:30am – 9:30am", "Lay Readers / Teachers Class: 5:00pm"],
          color: "danger",
          iconUrl: "",
        },
        {
          day: "Saturdays",
          title: "Choir / Youth / Brigade Activities",
          subtitle: "",
          time: ["5:00pm"],
          color: "secondary",
          iconUrl: "",
        },
      ];

      // Container form element
      const form = document.getElementById("activitiesForm");

      // Create unique input IDs
      function idFor(idx, field) {
        return `${field}${idx}`;
      }

      // Render activity tabs as editable cards with icon upload and controls
      function renderActivities() {
        form.innerHTML = ""; // clear existing

        activities.forEach((act, idx) => {
          const timesString = act.time.join(", ");

          const card = document.createElement("div");
          card.className = "col-md-6 col-lg-4";

          card.innerHTML = `
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title text-${
                                  act.color
                                } fw-bold mb-0">Activity ${idx + 1}</h5>
                                <button type="button" class="btn btn-sm btn-outline-danger" title="Delete Activity" onclick="deleteActivity(${idx})">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>

                            <!-- Icon Upload Section -->
                            <div class="mb-3 text-center">
                                <label class="form-label fw-semibold d-block">Activity Icon</label>

                                <div class="mb-2">
                                    <img
                                        src="${
                                          act.iconUrl ||
                                          "https://via.placeholder.com/64?text=No+Icon"
                                        }"
                                        alt="Activity Icon"
                                        id="iconPreview${idx}"
                                        class="img-thumbnail"
                                        style="max-height: 64px; object-fit: contain;"
                                    />
                                </div>

                                <input type="file" accept="image/*" class="form-control form-control-sm mb-1" id="iconFile${idx}" onchange="handleIconUpload(event, ${idx})" />

                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeIcon(${idx})" ${
            !act.iconUrl ? "disabled" : ""
          }>
                                    <i class="fa fa-trash me-1"></i>Remove Icon
                                </button>
                            </div>

                            <div class="mb-3">
                                <label for="${idFor(
                                  idx,
                                  "day"
                                )}" class="form-label fw-semibold">Day</label>
                                <input type="text" class="form-control" id="${idFor(
                                  idx,
                                  "day"
                                )}" value="${act.day}" />
                            </div>

                            <div class="mb-3">
                                <label for="${idFor(
                                  idx,
                                  "title"
                                )}" class="form-label fw-semibold">Title</label>
                                <input type="text" class="form-control" id="${idFor(
                                  idx,
                                  "title"
                                )}" value="${act.title}" />
                            </div>

                            <div class="mb-3">
                                <label for="${idFor(
                                  idx,
                                  "subtitle"
                                )}" class="form-label fw-semibold">Subtitle</label>
                                <input type="text" class="form-control" id="${idFor(
                                  idx,
                                  "subtitle"
                                )}" value="${act.subtitle}" />
                            </div>

                            <div class="mb-3">
                                <label for="${idFor(
                                  idx,
                                  "time"
                                )}" class="form-label fw-semibold">Times (comma separated)</label>
                                <input type="text" class="form-control" id="${idFor(
                                  idx,
                                  "time"
                                )}" value="${timesString}" />
                            </div>

                            <div class="mb-3">
                                <label for="${idFor(
                                  idx,
                                  "color"
                                )}" class="form-label fw-semibold">Selected Color</label>
                                <select class="form-select" id="${idFor(
                                  idx,
                                  "color"
                                )}">
                                    <option value="primary" ${
                                      act.color === "primary" ? "selected" : ""
                                    }>Primary (Blue)</option>
                                    <option value="secondary" ${
                                      act.color === "secondary"
                                        ? "selected"
                                        : ""
                                    }>Secondary (Gray)</option>
                                    <option value="success" ${
                                      act.color === "success" ? "selected" : ""
                                    }>Success (Green)</option>
                                    <option value="danger" ${
                                      act.color === "danger" ? "selected" : ""
                                    }>Danger (Red)</option>
                                    <option value="warning" ${
                                      act.color === "warning" ? "selected" : ""
                                    }>Warning (Yellow)</option>
                                    <option value="info" ${
                                      act.color === "info" ? "selected" : ""
                                    }>Info (Cyan)</option>
                                    <option value="light" ${
                                      act.color === "light" ? "selected" : ""
                                    }>Light (Light)</option>
                                    <option value="dark" ${
                                      act.color === "dark" ? "selected" : ""
                                    }>Dark (Black)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `;

          form.appendChild(card);
        });
      }

      // Delete activity by index
      function deleteActivity(index) {
        if (confirm("Are you sure you want to delete this activity?")) {
          activities.splice(index, 1);
          renderActivities();
        }
      }

      // Remove icon from an activity
      function removeIcon(idx) {
        activities[idx].iconUrl = "";
        renderActivities();
      }

      // Handle icon file upload, preview and store base64 in activities array
      function handleIconUpload(event, idx) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          activities[idx].iconUrl = e.target.result; // base64 image string
          renderActivities();
        };
        reader.readAsDataURL(file);
      }

      // Add a new blank activity
      function addActivity() {
        activities.push({
          day: "",
          title: "",
          subtitle: "",
          time: [],
          color: "primary",
          iconUrl: "",
        });
        renderActivities();
      }

      // Gather data from inputs and update activities array
      function updateActivitiesFromForm() {
        activities.forEach((act, idx) => {
          act.day = document.getElementById(idFor(idx, "day")).value.trim();
          act.title = document.getElementById(idFor(idx, "title")).value.trim();
          act.subtitle = document
            .getElementById(idFor(idx, "subtitle"))
            .value.trim();
          act.time = document
            .getElementById(idFor(idx, "time"))
            .value.split(",")
            .map((t) => t.trim())
            .filter((t) => t.length > 0);
          act.color = document.getElementById(idFor(idx, "color")).value;
          // iconUrl is managed directly on upload/delete, no input here
        });
      }

      // Save changes logic (ready for API)
      async function saveActivities() {
        updateActivitiesFromForm();

        // Example API call (uncomment and modify accordingly)
        /*
            try {
                const response = await fetch('/api/save-activities', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ activities })
                });

                if (!response.ok) {
                    throw new Error('Failed to save activities');
                }
                alert('Activities saved successfully!');
            } catch (error) {
                alert('Error saving activities: ' + error.message);
            }
            */

        // For now just alert success and console.log data
        console.log("Activities to save:", activities);
        alert("Save function triggered! Connect your API to persist changes.");
      }

      // Event Listeners
      document
        .getElementById("addActivityBtn")
        .addEventListener("click", addActivity);
      document
        .getElementById("saveActivitiesBtn")
        .addEventListener("click", saveActivities);

      // Initial render
      renderActivities();
    </script>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
