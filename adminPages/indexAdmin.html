<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Admin - Testimonials</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container py-4">
      <h1 class="text-center text-primary fw-bold mb-4">
        Testimonial Management
      </h1>

      <div class="row" id="testimonialCards"></div>

      <!-- Add Testimonial Button -->
      <div class="text-center mt-4">
        <button class="btn btn-outline-success px-4" onclick="addTestimonial()">
          <i class="fas fa-plus me-2"></i>Add Testimonial
        </button>
      </div>

      <!-- Save Button -->
      <div class="text-center mt-4">
        <button class="btn btn-primary px-5" onclick="saveTestimonials()">
          <i class="fas fa-save me-2"></i>Save Changes
        </button>
      </div>
    </div>

    <script>
      let testimonials = [
        {
          name: "Mrs Ebipatei Sobijoh",
          role: "Member",
          stars: 5,
          text: "She is thanking God for saving and healing her from a fatal home accident that broke her leg and left her unable to walk well for more than 6 months. She is great full to God and wants to use this medium to return all Glory to God",
          image: "img/testimonial-1.jpg",
        },
        {
          name: "John Doe",
          role: "Usher",
          stars: 4,
          text: "The church has changed my life in so many ways. Grateful to be part of this family.",
          image: "img/testimonial-2.jpg",
        },
      ];

      function renderCards() {
        const container = document.getElementById("testimonialCards");
        container.innerHTML = "";

        testimonials.forEach((t, i) => {
          container.innerHTML += `
        <div class="col-md-6 mb-4">
          <div class="card border-primary shadow-sm">
            <div class="card-body">
              <div class="mb-3 text-center">
                <img src="${t.image}" alt="Testimonial Image" id="preview-${i}" class="img-thumbnail" style="max-height: 150px;" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Upload New Image</label>
                <input type="file" class="form-control" onchange="previewImage(event, ${i})" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Name</label>
                <input type="text" class="form-control" value="${t.name}" onchange="testimonials[${i}].name = this.value" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Role</label>
                <input type="text" class="form-control" value="${t.role}" onchange="testimonials[${i}].role = this.value" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Stars (1â€“5)</label>
                <input type="number" min="1" max="5" class="form-control" value="${t.stars}" onchange="testimonials[${i}].stars = this.value" />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold">Testimony</label>
                <textarea class="form-control" rows="4" onchange="testimonials[${i}].text = this.value">${t.text}</textarea>
              </div>
              <div class="text-center">
                <button class="btn btn-outline-danger px-4" onclick="deleteTestimonial(${i})">
                  <i class="fas fa-trash me-2"></i>Delete
                </button>
              </div>
            </div>
          </div>
        </div>`;
        });
      }

      function addTestimonial() {
        testimonials.push({
          name: "",
          role: "",
          stars: 5,
          text: "",
          image: "img/placeholder.jpg",
        });
        renderCards();
      }

      function deleteTestimonial(index) {
        if (confirm("Are you sure you want to delete this testimonial?")) {
          testimonials.splice(index, 1);
          renderCards();
        }
      }

      function previewImage(event, index) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            testimonials[index].image = e.target.result;
            document.getElementById(`preview-${index}`).src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      }

      function saveTestimonials() {
        fetch("/api/testimonials/update", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(testimonials),
        })
          .then((res) => {
            if (res.ok) {
              alert("Testimonials updated successfully!");
            } else {
              alert("Failed to update testimonials.");
            }
          })
          .catch(() => alert("Error occurred while saving."));
      }

      renderCards();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
